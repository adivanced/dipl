; PS2 controller
single_channel_PS2 db 0 ; 0 - dual, 1 - single

PS2_port_1_working db 0
PS2_port_2_working db 0

port_1_dev_id db 0, 0
port_2_dev_id db 0, 0

; PS2 keyboard
sccode_got_E1 db 0
sccode_got_E0 db 0
sccode_got_F0 db 0

; E0=0 F0=0
sccode_lookup_0 db 0, 44, 0, 40, 38, 36, 37, 47, 0, 45, 43, 41, 39, 63, 58, 0, 0, 65, 66, 0, 64, 16, 26, 0, 0, 0, 25, 18, 0, 22, 27, 0, 0, 2, 23, 3, 4, 29, 28, 0, 0, 59, 21, 5, 19, 17, 30, 0, 0, 13, 1, 7, 6, 24, 31, 0, 0, 0, 12, 9, 20, 32, 33, 0, 0, 53, 10, 8, 14, 35, 34, 0, 0, 52, 50, 11, 54, 15, 49, 0, 0, 0, 57, 0, 55, 48, 0, 0, 68, 67, 61, 56, 0, 51, 0, 0, 0, 0, 0, 0, 0, 0, 60, 0, 0, 71, 0, 74, 77, 0, 0, 0, 80, 84, 72, 75, 76, 78, 62, 70, 46, 81, 73, 82, 83, 79, 69, 0, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 

; E0=1 F0=0
sccode_lookup_1 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 85, 99, 0, 0, 86, 100, 0, 0, 87, 0, 0, 0, 0, 0, 0, 114, 88, 101, 0, 115, 0, 0, 0, 116, 89, 0, 0, 117, 0, 0, 0, 118, 90, 0, 107, 0, 91, 0, 0, 119, 92, 0, 108, 120, 0, 0, 0, 121, 93, 0, 0, 0, 0, 0, 0, 0, 94, 0, 109, 0, 0, 102, 0, 0, 95, 0, 0, 0, 0, 0, 0, 0, 0, 0, 110, 0, 0, 0, 111, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 0, 122, 96, 0, 0, 0, 97, 104, 112, 0, 98, 105, 0, 0, 0, 0, 113, 0, 0, 106, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

; E0=0 F0=1
sccode_lookup_2 db 0, 178, 0, 230, 161, 179, 204, 231, 0, 180, 205, 232, 162, 181, 206, 0, 0, 182, 207, 0, 163, 183, 208, 0, 0, 0, 209, 233, 164, 184, 210, 0, 0, 185, 211, 234, 165, 186, 212, 0, 0, 187, 213, 235, 166, 188, 214, 0, 0, 189, 215, 236, 167, 190, 216, 0, 0, 0, 217, 237, 168, 191, 218, 0, 0, 192, 219, 238, 169, 193, 220, 0, 0, 194, 221, 239, 170, 195, 222, 0, 0, 0, 223, 0, 171, 196, 0, 0, 172, 197, 224, 240, 0, 198, 0, 0, 0, 0, 0, 0, 0, 0, 225, 0, 0, 199, 0, 241, 173, 0, 0, 0, 174, 200, 226, 242, 175, 201, 227, 243, 176, 202, 228, 244, 177, 203, 229, 0, 0, 0, 0, 245, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

; E0=1 F0=1
sccode_lookup_3 db 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 123, 137, 0, 0, 124, 138, 0, 0, 125, 0, 0, 0, 0, 0, 0, 145, 126, 139, 0, 146, 0, 0, 0, 147, 127, 0, 0, 148, 0, 0, 0, 149, 128, 0, 154, 0, 129, 0, 0, 150, 130, 0, 155, 151, 0, 0, 0, 152, 131, 0, 0, 0, 0, 0, 0, 0, 132, 0, 156, 0, 0, 140, 0, 0, 133, 0, 0, 0, 0, 0, 0, 0, 0, 0, 157, 0, 0, 0, 158, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 141, 0, 153, 134, 0, 0, 0, 135, 142, 159, 0, 136, 143, 0, 0, 0, 0, 160, 0, 0, 144, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0




cur_set db 0

sccode_circ_buf_ptr dq 0
sccode_circ_buf: times 512 db 0

; PS2 mouse
mouse_byte_recv dq 0
mouse_packet db 0, 0, 0, 0


mouse_x dq 0
mouse_y dq 0
mouse_z dq 0
mouse_l db 0
mouse_r db 0
mouse_m db 0